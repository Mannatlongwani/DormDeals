<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>My Listings — DormDeals</title>
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
  <link href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.10.5/font/bootstrap-icons.css" rel="stylesheet">
  <link rel="stylesheet" href="/css/style.css" />
</head>
<body>
    <div id="navbar-container"></div>

  <main class="container py-5">
    <h1 class="h4 mb-4">My Listings</h1>
    <div id="myProducts" class="list-group">
      <!-- items inserted here -->
    </div>
  </main>
  <div id="footer-container"></div>
  <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
  <script src="js/main.js"></script>
  <script>
    renderNav();
    if (!requireAuthOrRedirect()) { /* redirected */ }

    async function refreshProfile() {
      const container = document.getElementById("myProducts");
      container.innerHTML = "<div class='text-center py-4'>Loading...</div>";
      try {
        const data = await loadProfile(); // returns whole profile data
        const prods = data.myproducts || [];
        if (!prods.length) {
          container.innerHTML = "<div class='text-muted'>You have no listings. <a href='sell.html'>Post one</a>.</div>";
          return;
        }
        container.innerHTML = "";
        prods.forEach(p => {
          const item = document.createElement("div");
          item.className = "list-group-item d-flex justify-content-between align-items-center";
          item.innerHTML = `
            <div>
              <div><strong>${p.pname}</strong></div>
              <div class="">₹${p.pprice}</div>
            </div>
            <div>
              <a class="btn btn-sm btn-outline-primary me-2" href="product.html?id=${p.id}">View</a>
              <button class="btn btn-sm btn-danger" onclick="onDelete('${p.id}')">Delete</button>
            </div>
          `;
          container.appendChild(item);
        });
      } catch (err) {
        console.error(err);
        container.innerHTML = "<div class='text-danger'>Failed to load profile.</div>";
      }
    }

    async function onDelete(pid) {
      if (!confirm("Delete this product?")) return;
      try {
        await deleteMyProduct(pid);
        alert("Deleted");
        refreshProfile();
      } catch (err) {
        alert(err || "Delete failed");
      }
    }

    refreshProfile();
  </script>
</body>
</html>
